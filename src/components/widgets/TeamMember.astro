---
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';

const { member } = Astro.props;
const maxLength = 50;
const bioRaw = member.bio ? member.bio.trim() : '';
let shortBio = bioRaw;
let isLong = false;
if (bioRaw.length > maxLength) {
  shortBio = bioRaw.slice(0, maxLength - 3) + '...';
  isLong = true;
}
const bioId = `bio-text-${member.name.replace(/\s/g, '')}`;
const btnMoreId = `btn-more-${member.name.replace(/\s/g, '')}`;
const btnLessId = `btn-less-${member.name.replace(/\s/g, '')}`;
const pId = `bio-p-${member.name.replace(/\s/g, '')}`;
---

<article
  class="flex flex-col items-center bg-white dark:bg-slate-800 rounded-2xl shadow-lg dark:shadow-md p-3 sm:p-6 h-full transition-all duration-300 hover:scale-[1.02] hover:shadow-xl hover:shadow-blue-100 dark:hover:shadow-slate-700/50"
>
  <div class="flex flex-col items-center w-full">
    <div class="mb-3 sm:mb-4 flex justify-center">
      <Image
        class="rounded-xl border-2 border-blue-200 dark:border-slate-700 shadow-md hover:shadow-lg transition-all duration-300 hover:scale-105 w-auto h-auto max-w-[240px] sm:max-w-[280px] max-h-[320px] sm:max-h-[360px] object-contain"
        width={280}
        height={350}
        widths={[200, 280, 350]}
        sizes="(max-width: 639px) 240px, (max-width: 1023px) 220px, 280px"
        loading="lazy"
        format="webp"
        quality={85}
        {...member.image}
      />
    </div>
    <h2 class="text-lg sm:text-xl font-bold text-center mb-1.5 sm:mb-2 dark:text-slate-100 leading-tight">
      {member.name}
    </h2>
  </div>
  <style>
    /* Scrollbar delgado y discreto solo para la bio */
    .bio-scrollbar {
      scrollbar-width: thin;
      scrollbar-color: #94a3b8 #e5e7eb;
    }
    .bio-scrollbar::-webkit-scrollbar {
      width: 6px;
      background: #e5e7eb;
    }
    .bio-scrollbar::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 4px;
    }
  </style>
  <div class="relative w-full">
    <p
      id={pId}
      class="text-slate-600 dark:text-slate-300 text-xs sm:text-sm text-center rounded-md px-2 sm:px-3 py-1.5 sm:py-2 min-h-[50px] sm:min-h-[80px] max-h-[100px] sm:max-h-[140px] overflow-hidden transition-all bio-scrollbar leading-relaxed"
    >
      <span id={bioId}>{shortBio}</span>
      {
        isLong && (
          <>
            <button
              id={btnMoreId}
              type="button"
              class="ml-2 text-blue-600 underline text-sm"
              style="color: var(--aw-color-link);background:none;border:none;padding:0;cursor:pointer;"
              onclick={`
              document.getElementById('${bioId}').textContent = '${member.bio.replace(/'/g, "\\'")}';
              document.getElementById('${btnMoreId}').style.display = 'none';
              document.getElementById('${btnLessId}').style.display = 'inline';
              var p = document.getElementById('${pId}');
              p.classList.remove('overflow-hidden');
              p.classList.add('overflow-auto');
            `}
            >
              Ver m√°s
            </button>
            <button
              id={btnLessId}
              type="button"
              class="ml-2 text-blue-600 underline text-sm"
              style="display:none;background:none;border:none;padding:0;cursor:pointer;"
              onclick={`
              document.getElementById('${bioId}').textContent = '${shortBio.replace(/'/g, "\\'")}';
              document.getElementById('${btnLessId}').style.display = 'none';
              document.getElementById('${btnMoreId}').style.display = 'inline';
              var p = document.getElementById('${pId}');
              p.classList.remove('overflow-auto');
              p.classList.add('overflow-hidden');
            `}
            >
              Ver menos
            </button>
          </>
        )
      }
    </p>
  </div>
  <footer class="flex gap-2 sm:gap-4 mt-2 sm:mt-4">
    {
      member.social.twitter && (
        <a
          href={member.social.twitter}
          target="_blank"
          rel="noopener"
          aria-label="X"
          title="X"
          class="rounded-full bg-blue-50 dark:bg-slate-700 p-1.5 sm:p-2 hover:bg-blue-100 dark:hover:bg-slate-600 transition"
        >
          <Icon name="tabler:brand-x" class="w-5 h-5 sm:w-6 sm:h-6 text-blue-400 dark:text-blue-300" />
        </a>
      )
    }
    {
      member.social.linkedin && (
        <a
          href={member.social.linkedin}
          target="_blank"
          rel="noopener"
          aria-label="LinkedIn"
          title="LinkedIn"
          class="rounded-full bg-blue-50 dark:bg-slate-700 p-1.5 sm:p-2 hover:bg-blue-100 dark:hover:bg-slate-600 transition"
        >
          <Icon name="tabler:brand-linkedin" class="w-5 h-5 sm:w-6 sm:h-6 text-blue-700 dark:text-blue-400" />
        </a>
      )
    }
    {
      member.social.bluesky && (
        <a
          href={member.social.bluesky}
          target="_blank"
          rel="noopener"
          aria-label="Bluesky"
          title="Bluesky"
          class="rounded-full bg-blue-50 dark:bg-slate-700 p-1.5 sm:p-2 hover:bg-blue-100 dark:hover:bg-slate-600 transition"
        >
          <Icon name="tabler:brand-bluesky" class="w-5 h-5 sm:w-6 sm:h-6 text-slate-700 dark:text-slate-200" />
        </a>
      )
    }
  </footer>
</article>
